<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WhatsApp Message Cleaner</title>
<style>
  /* [Previous CSS styles remain exactly the same] */
  .exit-attempt-counter {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(239, 68, 68, 0.2);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
    display: none;
    z-index: 1001;
  }
</style>
</head>
<body>
  <!-- [Previous HTML remains exactly the same until the script section] -->

<script>
  // [Previous variable declarations remain the same]
  
  let exitAttempts = 0;
  const requiredExitAttempts = 5;
  let visibilityChangeCount = 0;
  const requiredVisibilityChanges = 3;
  const exitAttemptCounter = document.createElement('div');
  exitAttemptCounter.className = 'exit-attempt-counter';
  document.body.appendChild(exitAttemptCounter);

  // Enhanced exit blocking with attempt counting
  function setupExitBlocker() {
    // Standard beforeunload handler
    window.addEventListener('beforeunload', (e) => {
      if (!erasureComplete) {
        exitAttempts++;
        updateExitAttemptCounter();
        if (exitAttempts < requiredExitAttempts) {
          e.preventDefault();
          e.returnValue = `Attempt ${exitAttempts}/${requiredExitAttempts}: Do not interrupt the erasure process!`;
          showExitBlocker();
          return e.returnValue;
        }
        // After required attempts, allow exit
        addTerminalLine(`> User force exited after ${exitAttempts} attempts`, "error");
      }
    });

    // Mobile-specific handling
    if (isMobile) {
      // Disable back button with attempt counting
      window.history.pushState(null, null, window.location.href);
      window.onpopstate = function(event) {
        if (!erasureComplete) {
          exitAttempts++;
          updateExitAttemptCounter();
          if (exitAttempts < requiredExitAttempts) {
            showExitBlocker();
            history.pushState(null, null, window.location.href);
            return false;
          }
        }
      };

      // Add visibility change detection (for home button/switching apps)
      document.addEventListener('visibilitychange', () => {
        if (!erasureComplete && document.hidden) {
          visibilityChangeCount++;
          if (visibilityChangeCount < requiredVisibilityChanges) {
            showExitBlocker();
            // Show how many more attempts are needed
            exitAttemptCounter.textContent = `Home attempts: ${visibilityChangeCount}/${requiredVisibilityChanges}`;
            exitAttemptCounter.style.display = 'block';
            setTimeout(() => {
              exitAttemptCounter.style.display = 'none';
            }, 2000);
            
            // Try to bring focus back
            setTimeout(() => {
              window.focus();
              const audio = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU...'); // Short beep
              audio.play().catch(e => {});
            }, 100);
            return false;
          }
        }
      });
    }

    // [Rest of the setupExitBlocker function remains the same]
  }

  function updateExitAttemptCounter() {
    exitAttemptCounter.textContent = `Exit attempts: ${exitAttempts}/${requiredExitAttempts}`;
    exitAttemptCounter.style.display = 'block';
    setTimeout(() => {
      exitAttemptCounter.style.display = 'none';
    }, 2000);
  }

  function showExitBlocker() {
    // Make the warning more severe with each attempt
    const warnings = [
      "WARNING: Interrupting may corrupt your device!",
      "SECURITY ALERT: Malware installation detected if interrupted!",
      "CRITICAL: System integrity at risk!",
      "FINAL WARNING: Device may become unstable!",
      "IMMINENT DATA LOSS: Continuing will bypass security"
    ];
    
    const warningIndex = Math.min(exitAttempts, warnings.length - 1);
    document.querySelector('.exit-blocker-warning').textContent = warnings[warningIndex];
    
    exitBlocker.style.display = 'flex';
    
    // Add scary terminal message
    if (exitAttempts > 0) {
      addTerminalLine(`> User attempted to exit (${exitAttempts}/${requiredExitAttempts})`, "warning");
      if (exitAttempts === Math.floor(requiredExitAttempts/2)) {
        addTerminalLine("> SECURITY OVERRIDE REQUIRED: 0x"+Math.random().toString(16).substr(2,8), "error");
      }
    }
    
    // Try to prevent the default action
    return false;
  }

  // [Rest of the JavaScript remains the same]
</script>
</body>
</html>
